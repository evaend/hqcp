<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.phxl.hqcp.dao.OrgInfoMapper">
  <resultMap id="BaseResultMap" type="com.phxl.hqcp.entity.OrgInfo">
    <id column="ORG_ID" jdbcType="DECIMAL" property="orgId" />
    <result column="ORG_NAME" jdbcType="VARCHAR" property="orgName" />
    <result column="ORG_CODE" jdbcType="VARCHAR" property="orgCode" />
    <result column="FQUN" jdbcType="VARCHAR" property="fqun" />
    <result column="ORG_ALIAS" jdbcType="VARCHAR" property="orgAlias" />
    <result column="TF_PROVINCE" jdbcType="VARCHAR" property="tfProvince" />
    <result column="TF_CITY" jdbcType="VARCHAR" property="tfCity" />
    <result column="TF_DISTRICT" jdbcType="VARCHAR" property="tfDistrict" />
    <result column="ORG_TYPE" jdbcType="VARCHAR" property="orgType" />
    <result column="FLAG" jdbcType="VARCHAR" property="flag" />
    <result column="PARENT_ID" jdbcType="DECIMAL" property="parentId" />
    <result column="LXR" jdbcType="VARCHAR" property="lxr" />
    <result column="LXDH" jdbcType="VARCHAR" property="lxdh" />
    <result column="TF_ACCESSORY" jdbcType="VARCHAR" property="tfAccessory" />
    <result column="TF_LOGO" jdbcType="VARCHAR" property="tfLogo" />
    <result column="AUDIT_ID" jdbcType="VARCHAR" property="auditId" />
    <result column="AUDIT_NAME" jdbcType="VARCHAR" property="auditName" />
    <result column="AUDIT_TIME" jdbcType="DATE" property="auditTime" />
    <result column="AUDIT_FSTATE" jdbcType="VARCHAR" property="auditFstate" />
    <result column="CREATE_TIME" jdbcType="DATE" property="createTime" />
    <result column="CREATE_USER_ID" jdbcType="VARCHAR" property="createUserId" />
    <result column="CREATE_USER_NAME" jdbcType="VARCHAR" property="createUserName" />
    <result column="MODIFY_TIME" jdbcType="DATE" property="modifyTime" />
    <result column="MODEFILE_USER_ID" jdbcType="VARCHAR" property="modefileUserId" />
    <result column="MODEFILE_USER_NMAE" jdbcType="VARCHAR" property="modefileUserNmae" />
    <result column="TF_REMARK" jdbcType="VARCHAR" property="tfRemark" />
    <result column="AUDIT_ORG_CODE" jdbcType="VARCHAR" property="auditOrgCode" />
    <result column="AUDIT_TF_ACCESSORY" jdbcType="VARCHAR" property="auditTfAccessory" />
  </resultMap>
  <sql id="Base_Column_List">
    ORG_ID, ORG_NAME, ORG_CODE, FQUN, ORG_ALIAS, TF_PROVINCE, TF_CITY, TF_DISTRICT, ORG_TYPE, 
    FLAG, PARENT_ID, LXR, LXDH, TF_ACCESSORY, TF_LOGO, AUDIT_ID, AUDIT_NAME, AUDIT_TIME, 
    AUDIT_FSTATE, CREATE_TIME, CREATE_USER_ID, CREATE_USER_NAME, MODIFY_TIME, MODEFILE_USER_ID, 
    MODEFILE_USER_NMAE, TF_REMARK, AUDIT_ORG_CODE, AUDIT_TF_ACCESSORY
  </sql>
  
   <select id="findOrgNameOrOrgCodeExist" resultType="int">
	select COUNT(1) from (
	    <if test="type != null and type == 'orgName' ">
	    select TD_ORG_INFO.ORG_NAME from TD_ORG_INFO where TD_ORG_INFO.ORG_NAME = #{orgValue,jdbcType=VARCHAR}
		    <if test="orgId != null and orgId > 0">
			  and TD_ORG_INFO.ORG_ID not in ( #{orgId, jdbcType=DECIMAL} )
		    </if>
        UNION
        select TD_ORG_REGIST.Org_Name from TD_ORG_REGIST where TD_ORG_REGIST.Audit_Fstate = '00' and TD_ORG_REGIST.Org_Name = #{orgValue,jdbcType=VARCHAR}
	    </if>
	    <if test="type != null and type == 'orgCode' ">
	    select TD_ORG_INFO.Org_Code from TD_ORG_INFO where TD_ORG_INFO.Org_Code = #{orgValue,jdbcType=VARCHAR}
		    <if test="orgId != null and orgId > 0">
			  and TD_ORG_INFO.ORG_ID not in ( #{orgId, jdbcType=DECIMAL} )
		    </if>
		UNION
		select TD_ORG_REGIST.Org_Code from TD_ORG_REGIST where TD_ORG_REGIST.Audit_Fstate = '00' and TD_ORG_REGIST.Org_Code = #{orgValue,jdbcType=VARCHAR}
	    </if>
    )
  </select>
  
  <select id="searchOrgInfoList" resultType="HashMap" parameterType="com.phxl.core.base.entity.Pager">
   select TD_ORG_INFO.ORG_ID,TD_ORG_INFO.Org_Type,TD_ORG_INFO.ORG_NAME,TD_ORG_INFO.Fstate,TD_ORG_INFO.Org_Alias,TD_ORG_INFO.Tf_Province,TD_ORG_INFO.Tf_City,TD_ORG_INFO.Tf_District,
		  to_char(TD_ORG_INFO.Modify_Time,'yyyy-MM-dd') MODIFY_TIME,TD_ORG_INFO.Vip_Level,TD_ORG_INFO.ORG_CODE,TD_ORG_INFO.Parent_Orgid,TD_ORG_INFO.LEGAL_MAN,org.ORG_NAME as PARENT_ORGNAME,
		  TD_ORG_INFO.Flag,TD_ORG_INFO.Lxr,TD_ORG_INFO.Lxdh,TD_ORG_INFO.Tf_Address,TD_ORG_INFO.Tf_Bank,TD_ORG_INFO.Bank_Account,TD_ORG_INFO.Tf_Remark,
		  TD_HOSPITAL_INFO.Hospital_Level,TD_HOSPITAL_INFO.HOSPITAL_PROPERTY,TD_HOSPITAL_INFO.TAX_NO,TD_SUPPLIER_INFO.CORPORATION_TYPE,TD_SUPPLIER_INFO.Rmb_Amount,
		  GET_STATICDATA(TD_SUPPLIER_INFO.CORPORATION_TYPE,'CORPORATION_TYPE') AS CORPORATION_TYPENAME,GET_STATICDATA(TD_HOSPITAL_INFO.Hospital_Level,'HOSPITAL_LEVEL') AS HOSPITAL_LEVELNAME,
		  GET_STATICDATA(TD_HOSPITAL_INFO.HOSPITAL_PROPERTY,'HOSPITAL_PROPERTY') AS HOSPITAL_PROPERTYNAME
   from TD_ORG_INFO left join TD_HOSPITAL_INFO on TD_HOSPITAL_INFO.ORG_ID = TD_ORG_INFO.Org_Id
                    left join TD_SUPPLIER_INFO on TD_SUPPLIER_INFO.ORG_ID = TD_ORG_INFO.Org_Id
                    left join TD_ORG_INFO org on org.ORG_ID = TD_ORG_INFO.Parent_Orgid
   
	where 1 = 1
	  <if test="conditiions!=null and conditiions.orgId != null and conditiions.orgId > 0">
		  and TD_ORG_INFO.ORG_ID = #{conditiions.orgId, jdbcType=DECIMAL}
	  </if>
	  <if test="conditiions!=null and conditiions.orgType != null and conditiions.orgType != ''">
		  and TD_ORG_INFO.Org_Type = #{conditiions.orgType, jdbcType=VARCHAR}
	  </if>
	  <if test="conditiions!=null and conditiions.searchName != null and conditiions.searchName != ''">
		<![CDATA[  and ( regexp_like(TD_ORG_INFO.ORG_NAME, #{conditiions.searchName,jdbcType=VARCHAR})
    			   or   regexp_like(TD_ORG_INFO.Org_Alias, #{conditiions.searchName,jdbcType=VARCHAR}) 
    			   or   regexp_like(TD_ORG_INFO.FQUN, #{conditiions.searchName,jdbcType=VARCHAR}))]]>
	  </if>
	
	  <choose>
		   <when test="conditiions!=null and conditiions.sortCol!= null and conditiions.sortCol != ''">
		    order by ${conditiions.sortCol} ${conditiions.sortType}
		   </when>
		   <otherwise>
		   order by TD_ORG_INFO.MODIFY_TIME desc
		   </otherwise>
	  </choose> 
    </select>
  
     <select id="searchParentOrgInfoList" resultType="hashMap" parameterType="com.phxl.core.base.entity.Pager">
	  	select TD_ORG_INFO.ORG_ID AS "value",TD_ORG_INFO.ORG_NAME AS "text" from TD_ORG_INFO where TD_ORG_INFO.Flag = '00'
	  	<if test="conditiions !=null and conditiions.orgId !=null and conditiions.orgId > 0">
		  	and TD_ORG_INFO.Org_Id not in (
			  select TD_ORG_INFO.ORG_ID from TD_ORG_INFO where TD_ORG_INFO.Org_Id = #{conditiions.orgId, jdbcType=DECIMAL} or TD_ORG_INFO.Parent_Orgid = #{conditiions.orgId, jdbcType=DECIMAL}
			)
	  	</if>
	  	<if test="conditiions !=null and conditiions.searchName !=null and conditiions.searchName != ''">
		  	and regexp_like(TD_ORG_INFO.ORG_NAME, #{conditiions.searchName,jdbcType=VARCHAR}) 
	  	</if>
	 </select>
	 
	 <!-- 查询机构列表（联想下拉搜索） -->
	 <select id="findOrgListForSelector" resultType="java.util.LinkedHashMap" parameterType="com.phxl.core.base.entity.Pager">
		SELECT
		  DISTINCT o.ORG_ID "value", o.ORG_NAME "text"
		FROM  TD_ORG_INFO o
		WHERE o.FSTATE='01'
		<if test="conditiions!=null">
			<if test="conditiions.orgTypes!=null and conditiions.orgTypes.length>0">
				and o.ORG_TYPE in  
				<foreach collection="conditiions.orgTypes" item="item" index="index" open="(" close=")" separator=",">
					#{conditiions.orgTypes[${index}], jdbcType=VARCHAR}
				</foreach>
			</if>
			<if test="conditiions.searchName!=null and conditiions.searchName!=''">
				and regexp_like(o.ORG_NAME, #{conditiions.searchName, jdbcType=VARCHAR})
			</if>
		</if>
	</select>
</mapper>