<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.phxl.hqcp.dao.SelectScopeMapper" >
  <resultMap id="BaseResultMap" type="com.phxl.hqcp.entity.SelectScope" >
    <id column="SELECT_SCOPE_GUID" property="selectScopeGuid" jdbcType="VARCHAR" />
    <result column="SELECT_ORG_ID" property="selectOrgId" jdbcType="DECIMAL" />
    <result column="ORG_ID" property="orgId" jdbcType="DECIMAL" />
    <result column="P_YEAR" property="pYear" jdbcType="VARCHAR" />
    <result column="P_YMD" property="pYmd" jdbcType="VARCHAR" />
    <result column="START_DATE" property="startDate" jdbcType="DATE" />
    <result column="END_DATE" property="endDate" jdbcType="DATE" />
    <result column="CREATE_TIME" property="createTime" jdbcType="DATE" />
    <result column="CREATE_USER_ID" property="createUserId" jdbcType="VARCHAR" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="DATE" />
    <result column="MODEFILE_USER_ID" property="modefileUserId" jdbcType="VARCHAR" />
    <result column="MODEFILE_USER_NMAE" property="modefileUserNmae" jdbcType="VARCHAR" />
    <result column="TF_REMARK" property="tfRemark" jdbcType="VARCHAR" />
    <result column="SELECT_SCOPE_SUB_TYPE" property="selectScopeSubType" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    SELECT_SCOPE_GUID, SELECT_ORG_ID, ORG_ID, P_YEAR, P_YMD, START_DATE, END_DATE, CREATE_TIME, 
    CREATE_USER_ID, CREATE_USER_NAME, MODIFY_TIME, MODEFILE_USER_ID, MODEFILE_USER_NMAE, 
    TF_REMARK, SELECT_SCOPE_SUB_TYPE
  </sql>
  
  <!-- 查询时间列表（科室建设-时间下拉框） -->
	<select id="getPyearList" resultType="java.util.LinkedHashMap" parameterType="com.phxl.core.base.entity.Pager">
		select distinct s.p_year "value", s.p_year "text" from TD_SELECT_SCOPE s
		where s.select_scope_sub_type = #{conditiions.selectScopeSubType, jdbcType=VARCHAR} 
		and s.p_ymd = #{conditiions.pYmd, jdbcType=VARCHAR}
	    and s.select_org_id = #{conditiions.orgId, jdbcType=DECIMAL}
	    order by s.p_year desc
	</select>
	
	<!-- 查询医院列表（科室建设） -->
	<select id="searchSelectScopeList" resultType="java.util.LinkedHashMap" parameterType="com.phxl.core.base.entity.Pager">
		select s.select_scope_guid "selectScopeGuid",t.constr_dept_guid "constrDeptGuid",s.org_id "orgId",o.org_name "orgName",
		       s.p_year "pYear",(CASE WHEN t.schedule is null THEN '0%' ELSE t.schedule*100.0||'%' END) "schedule",t.audit_fstate "auditFstate"
		from td_select_scope s 
		left join tb_constr_dept t on s.org_id = t.org_id and t.p_year = #{conditiions.pYear, jdbcType=VARCHAR} and t.p_ymd = #{conditiions.pYmd, jdbcType=VARCHAR} 
		                                                  and t.qc_scope_type = #{conditiions.qcScopeType, jdbcType=VARCHAR}
		left join TD_ORG_INFO o on o.org_id = s.org_id
		where s.select_org_id = #{conditiions.orgId, jdbcType=DECIMAL} and s.p_year = #{conditiions.pYear, jdbcType=VARCHAR} 
		  and s.p_ymd = #{conditiions.pYmd, jdbcType=VARCHAR} and s.select_scope_sub_type = #{conditiions.selectScopeSubType, jdbcType=VARCHAR}
		<if test="conditiions!=null and conditiions.searchName != null and conditiions.searchName != ''">
		  and regexp_like(o.org_name, #{conditiions.searchName,jdbcType=VARCHAR})
	    </if>
	    <if test="conditiions!=null and conditiions.fstate != null and conditiions.fstate != ''">
		  and t.audit_fstate in (#{conditiions.fstate,jdbcType=VARCHAR})
	    </if>
	</select>
  
</mapper>